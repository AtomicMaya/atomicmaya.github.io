<!DOCTYPE html><html lang="en-US"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="og:url" content="https://atomicnicos.me/post/2021/2021_08_31+Enumerating-the-lightshot-CDN">
  <meta name="og:locale" content="en_us">
  <meta name="og:site_name" content="https://atomicnicos.me">
  <meta name="og:title" content="Enumerating the Lightshot CDN | AtomicNicos's Blog">
  <meta name="og:description" content="How I went from the premise of an open CDN to exploiting it as a proof of concept">
  <meta name="og:image" content="https://atomicnicos.me/assets/images/cover.jpg">
  <meta name="description" content="How I went from the premise of an open CDN to exploiting it as a proof of concept">
  <meta name="keywords" content="atomicnicos, osint, infosec, security, cybersec, cybersecurity, enumerating, lightshot, prnt.sc, prntscr.com, CDN">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://atomicnicos.me/post/2021/2021_08_31+Enumerating-the-lightshot-CDN">
  <meta name="twitter:image" content="https://atomicnicos.me/assets/images/cover.jpg">
  <meta name="twitter:label1" content="Written By">
  <meta name="twitter:data1" content="Nicolas Boeckh">
  <meta name="twitter:site" content="@AtomicNicos">
  <meta name="twitter:creator" content="@AtomicNicos">
  <meta name="twitter:image:width" content="1280">
  <meta name="twitter:image:height" content="720">
  <title>Enumerating the Lightshot CDN | AtomicNicos's Blog</title>
  <base href="/">
  <link rel="icon" type="image/x-icon" href="favicon.png">
  <script id="twitter-wjs" src="https://platform.twitter.com/widgets.js"></script><script data-goatcounter="https://atomicnicos.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
  <script src="https://kit.fontawesome.com/88cfc0e7e2.js" integrity="sha384-sX7kjQzLM8MFrzb6uyCnPsr+HRySaCE3/aRRrej3bbJ3kjm5GXmGWM1oYePcm1BW" crossorigin="anonymous"></script>
  <!-- Github Pages hack to allow SPA refresh without receiving 404. -->
  <script>
    window.prerenderReady = false;
    (function () {
      // Retrieve the URL the user was trying to access when receiving the 404.
      var redirect = sessionStorage.redirect;
      // Remove the URL from sessionStorage.
      delete sessionStorage.redirect;
      // Check if we actually need to redirect.
      if (redirect && redirect != location.href) {
        // We need to redirect to the URL the user was trying to access.
        history.replaceState(null, null, redirect);
      }
    })();
  </script>
  <!-- /Github Pages hack. -->
<link rel="stylesheet" href="styles.b420e920c9dbafeb.css"><style ng-transition="atomicnicos-me">.sidebar[_ngcontent-sc72]{position:relative;float:left;width:30%;padding:0 10px;overflow-y:visible}</style><style ng-transition="atomicnicos-me">footer[_ngcontent-sc18]{border-top:1px dashed #b5e853}</style><style ng-transition="atomicnicos-me">.text-decoration-underline[_ngcontent-sc69]{text-decoration:underline}</style><style ng-transition="atomicnicos-me">div[_ngcontent-sc70] > a[_ngcontent-sc70] > span[_ngcontent-sc70]{margin:.25rem;padding:.5rem;background-color:#2e2e2e;border-radius:.25rem;font-size:smaller}div[_ngcontent-sc70] > a[_ngcontent-sc70]{margin:.5rem 0}</style><style ng-transition="atomicnicos-me">img[_ngcontent-sc54]{max-height:300px!important}</style><style ng-transition="atomicnicos-me">.twitter-tweet { transform: none !important; }</style><style ng-transition="atomicnicos-me">p[_ngcontent-sc20]{font-size:smaller;color:#aaa}</style><style ng-transition="atomicnicos-me">p[_ngcontent-sc21]{font-size:smaller;color:#aaa}span[_ngcontent-sc21]{margin:.375rem;padding:.5rem;border-radius:.5rem;background-color:#484848}</style></head>
<body>
  <app-root ng-version="14.2.1"><div class="h-100 w-100 d-flex flex-column justify-content-between"><app-header class="align-self-stretch"><header class="mb-3"><div class="container"><a id="a-title" href="/"><h1 class="ms-2">atomicnicos​@1337m4ch1n3</h1></a><h2>AtomicNicos's Blog at the end of the universe.</h2><nav><ul class="nav-lists d-flex flex-row flex-wrap"><li class="paths align-middle my-auto justify-content-center">Paths:</li><li class="nav-elements"><a href="/whoami">~$ whoami</a></li><li class="nav-elements"><a href="/posts">~$ ls -la ./posts</a></li></ul></nav></div></header></app-header><app-main-body class="align-self-stretch align-items-stretch mb-auto" _nghost-sc72=""><div _ngcontent-sc72="" class="container main-page"><div _ngcontent-sc72="" class="main-content"><router-outlet></router-outlet><app-enumerating-the-lightshot-cdn _nghost-sc54=""><app-post-body _ngcontent-sc54=""><h1>~$ Enumerating the Lightshot CDN</h1><app-when _nghost-sc20=""><p _ngcontent-sc20="">Posted on Aug. 31st, 2021. <!----></p></app-when><app-tag-viewer _nghost-sc21=""><p _ngcontent-sc21=""><strong _ngcontent-sc21="">Tags:</strong><span _ngcontent-sc21=""><a _ngcontent-sc21="" href="/tags/InfoSec">InfoSec</a></span><span _ngcontent-sc21=""><a _ngcontent-sc21="" href="/tags/Development">Development</a></span><span _ngcontent-sc21=""><a _ngcontent-sc21="" href="/tags/Privacy">Privacy</a></span><!----></p><!----><br _ngcontent-sc21=""></app-tag-viewer><div><h3 _ngcontent-sc54="">The Premise</h3><p _ngcontent-sc54="">Lightshot is a screen capture service provided for free on the Internet. It features a few functionalities including but not limited to screenshot editing, copying it to the copy-paste buffer and finally uploading the captured images to LightShot's CDN.</p><p _ngcontent-sc54="">That last part is the one of interest for us, as it was mentioned by <a _ngcontent-sc54="" target="_blank" href="https://twitter.com/illyrian598" rel="noopener"><em _ngcontent-sc54="" class="fab fa-twitter-square"></em> commandergirl</a> (see below) that LightShot's CDN (Content Delivery Network) was quite easy to enumerate.</p><div _ngcontent-sc54="" class="media-container"><ngx-tweet _ngcontent-sc54="" id="bc2-tweet" tweetid="1432084646473388039"><!----></ngx-tweet></div><p _ngcontent-sc54="">As a fun project I wanted to see how easy it was to enumerate all of the images uploaded to LightShot.</p><p _ngcontent-sc54="">Spoiler alert, it is really easy.</p><br _ngcontent-sc54=""><h3 _ngcontent-sc54="">Kowalski, Analysis!</h3><p _ngcontent-sc54="">The CDN is accessible via a URL that looks like <code _ngcontent-sc54="">hxxps[:]//prnt[.]sc/x</code> with <code _ngcontent-sc54="">x</code> being an alphanumerical string within the <code _ngcontent-sc54="">[0-9a-z]</code>.</p><p _ngcontent-sc54="">I upload two test images - with approximately 25 seconds between uploads - to LightShot's CDN, which are:</p><ul _ngcontent-sc54=""><li _ngcontent-sc54="">1qvc84l</li><li _ngcontent-sc54="">1qvc8ny</li></ul><p _ngcontent-sc54="">We can start by seeing that both codes seem sequential in nature, and assuming we are in the <code _ngcontent-sc54="">[0-9a-z]</code> space, show that a lot of images are constantly being uploaded to the CDN. The difference between <code _ngcontent-sc54="">1qvc84l</code> and <code _ngcontent-sc54="">1qvc8ny</code> is:</p><ul _ngcontent-sc54=""><li _ngcontent-sc54="">'l' to 'z' = 14 characters</li><li _ngcontent-sc54="">'50' to 'mz' = 17*36 = 612 characters</li><li _ngcontent-sc54="">'0' to 'y' = 35 characters</li></ul><p _ngcontent-sc54="">We can thus see there are approximately 659 URL segments between both of my uploads (uploads excluded), which comes down to approximately 26.5 images per second. That's a lot of images (in my best Phil Swift tone).</p><p _ngcontent-sc54="">But how many images could that represent? Well using bad math, I would have told you "at least 27M images", which would be completely wrong. Someone who has been doing math for a living mentioned that just for the 7 character segment - considering that the segment cannot start with a 0 (from experimentation) - we need <code _ngcontent-sc54="">35 * 36^6 ~= 76.12e9</code> or about 76.12 Billion possibilities. Summing up for character segments of size 1 to 7, we thus get <code _ngcontent-sc54="">35 * 36^6 + 35 * 36^5 + 35 * 36^4 + 35 * 36^3 + 35 * 36^2 + 35 * 36 + 36 ~= 78.36e9</code> or about 78.36 Billion possibilities. That is a lot. Thankfully we seem to be at <code _ngcontent-sc54="">1qxxxxx</code> which is somewhere at the beginning of the 7 character space (relatively to 78.36 Billion possibilities).</p><p _ngcontent-sc54="">For each of these URL segments, my initial impression of parsing that URL is that the page takes a few seconds to load, loading the image asynchroneously, thus requiring a more roundabout automated collection method. The image is available 1 of two ways, either in the image source, or as a data blob:</p><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/0-page-code.png" alt="The code of LightShot's page"></div><br _ngcontent-sc54=""><p _ngcontent-sc54="">To automate this, I turned to my favorite language: Python. Also in my quiver were the Selenium WebDriver library, BeautifulSoup4 and Multiprocess.</p><p _ngcontent-sc54="">By iterating over the namespace, and opening the page via Selenium in a headless Chrome then grabbing the page and jamming it into BS4, we can then find the image and it's blob, and then convert the blob, then saving it to the relevant file format.</p><p _ngcontent-sc54="">You can check that first functioning attempt at <a _ngcontent-sc54="" href="https://gist.github.com/AtomicNicos/d31462e2e9ed168f7665bf9e6b698daa"> here</a>.</p><br _ngcontent-sc54=""><h3 _ngcontent-sc54="">The quicker "I hadn't noticed that" approach</h3><p _ngcontent-sc54="">Meta tags. Apparently the LightShot page uses the <code _ngcontent-sc54="">&lt;meta property="og:image" content="x"&gt;</code> tag, which contains a link to an image... which can be scraped using the <code _ngcontent-sc54="">urllib</code> library. Thanks <a _ngcontent-sc54="" target="_blank" href="https://twitter.com/bugbot4" rel="noopener"><em _ngcontent-sc54="" class="fab fa-twitter-square"></em> Night</a> for pointing that out.</p><p _ngcontent-sc54="">By refactoring my code to include this modification, it became much easier and faster and less expensive to use, due to Selenium and BS4 being made redundant. You can find it <a _ngcontent-sc54="" href="https://gist.github.com/AtomicNicos/077c84c8c6ff1d431c5e3e7c050f9fd0"> here</a>.</p><p _ngcontent-sc54="">I had not removed parallel processing on my first try, and this method is "so" efficient, that it tripped CloudFlare's DOS mitigation (or, as CloudFlare claims, the owner banned my IP specifically, see below). Oops, I apologize. However, CloudFlare <strong _ngcontent-sc54="">is</strong> protecting a service used to share non-consensual pornography, scams and PII (regardless of own ToS) which would make a GDPR-specialized risk management firm sweat. I "fixed" it to continue my "research" and everything was nice and functional.</p><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/3-beaned.png" alt="CloudFlare's message"></div><br _ngcontent-sc54=""><h3 _ngcontent-sc54="">PII farming</h3><p _ngcontent-sc54="">I did just mention scams, NCP and PII, so here are some (heavily redacted) examples!</p><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/1-example-0.png" alt="Cryptocurrency platform credentials and PII"></div><div _ngcontent-sc54="" class="media-container"><caption _ngcontent-sc54="" class="text-align-center">Cryptocurrency platform credentials and PII</caption></div><br _ngcontent-sc54=""><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/1-example-1.jpg" alt="Cryptocurrency platform credentials"></div><div _ngcontent-sc54="" class="media-container"><caption _ngcontent-sc54="" class="text-align-center">Cryptocurrency platform credentials</caption></div><br _ngcontent-sc54=""><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/1-example-2.jpg" alt="Cryptocurrency platform credentials"></div><div _ngcontent-sc54="" class="media-container"><caption _ngcontent-sc54="" class="text-align-center">Cryptocurrency platform credentials</caption></div><br _ngcontent-sc54=""><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/1-example-3.jpg" alt="Cryptocurrency platform credentials, PII + Credit card information"></div><div _ngcontent-sc54="" class="media-container"><caption _ngcontent-sc54="" class="text-align-center">Cryptocurrency platform credentials, PII + Credit card information</caption></div><br _ngcontent-sc54=""><p _ngcontent-sc54="">It's a literal goldmine for people that wish to be malicious.</p><p _ngcontent-sc54="">To the question about why I am not going through vulnerability disclosure processes? Because the idea of scraping LightShot has been going on for a while (see below) and no one at LightShot seems to care.</p><div _ngcontent-sc54="" class="media-container"><img _ngcontent-sc54="" src="assets/images/2021/210831-lightshot/2-so.jpg" alt="A post on stack overflow about scraping LightShot from April 25th, 2017"></div><div _ngcontent-sc54="" class="media-container"><caption _ngcontent-sc54="" class="text-align-center">A post on Stack Overflow about scraping LightShot from April 25th, 2017</caption></div><p _ngcontent-sc54="">In conclusion, this is a case of *le big sigh*. Hope you've enjoyed, see you around.</p></div></app-post-body></app-enumerating-the-lightshot-cdn><!----><div _ngcontent-sc72=""><span _ngcontent-sc72=""></span><br _ngcontent-sc72=""></div></div><div _ngcontent-sc72="" class="sidebar"><app-sidebar _ngcontent-sc72=""><app-socials><h4>~$ Find me here</h4><div class="center d-flex flex-row justify-content-center flex-wrap"><div class="mx-2"><a target="_blank" href="https://twitter.com/AtomicNicos" rel="noopener"><em class="fab fa-twitter-square fa-2x"></em></a></div>​ <div class="mx-2"><a target="_blank" href="https://linkedin.com/in/nicolas-boeckh" rel="noopener"><em class="fab fa-linkedin fa-2x"></em></a></div>​ <div class="mx-2"><a target="_blank" href="https://github.com/AtomicNicos" rel="noopener"><em class="fab fa-github-square fa-2x"></em></a></div>​ <div class="mx-2"><a target="_blank" href="https://gitlab.unige.ch/Nicolas.Boeckh" rel="noopener"><em class="fab fa-gitlab fa-2x"></em></a></div>​ <div class="mx-2"><a target="_blank" href="https://keybase.io/atomicnicos" rel="noopener"><em class="fas fa-key fa-2x"></em></a></div>​
</div></app-socials><div class="separator my-4"></div><app-latest _nghost-sc69=""><h4 _ngcontent-sc69="">~$ Latest Posts</h4><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">26/04/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_04_26+running-the-digital-overdose-conference-again">Digital Overdose Conference 2: We're doing this again!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">18/02/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_02_18+Starting-a-new-job">I started a new job!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">30/01/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_01_30+knight-ctf-2022-reverse-writeups">Dissecting the KnightCTF Reverse Engineering challenges!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">30/01/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_01_30+knight-ctf-2022-programming-writeups">Dissecting the KnightCTF Programming challenges!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">30/01/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_01_30+knight-ctf-2022-misc-writeups">Dissecting the KnightCTF Misc challenges!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">30/01/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_01_30+knight-ctf-2022-cryptography-writeups">Dissecting the KnightCTF Cryptography challenges!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">29/01/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_01_29+knight-ctf-2022-all-writeups">Participating in KnightCTF!</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">15/01/2022:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2022/2022_01_15+catching-covid">Catching COVID, detailing my experience.</a></p></div><div _ngcontent-sc69="" class="my-2"><p _ngcontent-sc69="" class="m-0"><span _ngcontent-sc69="" class="text-decoration-underline">25/11/2021:</span>&nbsp; <a _ngcontent-sc69="" class="no-underline" href="post/2021/2021_11_25+speaking-at-conint">Speaking about communities at conINT</a></p></div><!----></app-latest><div class="separator my-4"></div><app-list-tag-count _nghost-sc70=""><h4 _ngcontent-sc70="">~$ Tags</h4><div _ngcontent-sc70="" class="d-flex flex-wrap"><a _ngcontent-sc70="" class="no-underline" href="/tags/Conference"><span _ngcontent-sc70="">Conference (8)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Community"><span _ngcontent-sc70="">Community (8)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/InfoSec"><span _ngcontent-sc70="">InfoSec (19)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/CyberSec"><span _ngcontent-sc70="">CyberSec (2)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Volunteering"><span _ngcontent-sc70="">Volunteering (3)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Professional"><span _ngcontent-sc70="">Professional (1)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Programming"><span _ngcontent-sc70="">Programming (4)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/CTF"><span _ngcontent-sc70="">CTF (14)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Write-Up"><span _ngcontent-sc70="">Write-Up (11)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Cryptography"><span _ngcontent-sc70="">Cryptography (2)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Personal"><span _ngcontent-sc70="">Personal (8)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/OSINT"><span _ngcontent-sc70="">OSINT (5)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/AppSec"><span _ngcontent-sc70="">AppSec (1)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Talks"><span _ngcontent-sc70="">Talks (6)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Development"><span _ngcontent-sc70="">Development (4)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Web"><span _ngcontent-sc70="">Web (3)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Privacy"><span _ngcontent-sc70="">Privacy (4)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/IOT"><span _ngcontent-sc70="">IOT (4)</span></a><a _ngcontent-sc70="" class="no-underline" href="/tags/Media"><span _ngcontent-sc70="">Media (1)</span></a><!----></div></app-list-tag-count></app-sidebar></div></div></app-main-body><app-footer class="align-items-end" _nghost-sc18=""><footer _ngcontent-sc18="" class="py-4 mt-3 footer"><div _ngcontent-sc18="" class="container center"><a _ngcontent-sc18="" routerlink="/copyright" href="/copyright">Copyright CC-BY-SA</a> AtomicNicos 2020-2021<br _ngcontent-sc18=""> (<a _ngcontent-sc18="" routerlink="/privacy-policy" href="/privacy-policy">Privacy Policy</a>) </div></footer></app-footer></div></app-root>
<script src="runtime.f728813b2372e83f.js" type="module"></script><script src="polyfills.c2d263228cd7da29.js" type="module"></script><script src="scripts.322bf2bede7b2054.js" defer=""></script><script src="main.fb2674b6a0e69afe.js" type="module"></script>


</body><!-- This page was prerendered with Angular Universal --></html>